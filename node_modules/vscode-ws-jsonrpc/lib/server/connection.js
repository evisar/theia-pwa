"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* --------------------------------------------------------------------------------------------
 * Copyright (c) 2018 TypeFox GmbH (http://www.typefox.io). All rights reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 * ------------------------------------------------------------------------------------------ */
var vscode_jsonrpc_1 = require("vscode-jsonrpc");
var disposable_1 = require("../disposable");
function forward(clientConnection, serverConnection, map) {
    clientConnection.forward(serverConnection, map);
    serverConnection.forward(clientConnection, map);
    clientConnection.onClose(function () { return serverConnection.dispose(); });
    serverConnection.onClose(function () { return clientConnection.dispose(); });
}
exports.forward = forward;
function createConnection(reader, writer, onDispose) {
    var disposeOnClose = new disposable_1.DisposableCollection();
    reader.onClose(function () { return disposeOnClose.dispose(); });
    writer.onClose(function () { return disposeOnClose.dispose(); });
    return {
        reader: reader, writer: writer,
        forward: function (to, map) {
            if (map === void 0) { map = function (message) { return message; }; }
            reader.listen(function (input) {
                var output = map(input);
                to.writer.write(output);
            });
        },
        onClose: function (callback) {
            return disposeOnClose.push(vscode_jsonrpc_1.Disposable.create(callback));
        },
        dispose: function () { return onDispose(); }
    };
}
exports.createConnection = createConnection;
//# sourceMappingURL=connection.js.map